<!-- views/partials/cartDrawer.ejs -->
<style>
  /* ----- Cart Drawer Polish (scoped b·∫±ng id) ----- */
  #cartDrawer {
    max-width: 420px;
    background: #fff;
    border-left: 1px solid #eef2f7;
    box-shadow: -8px 0 24px rgba(16,24,40,.08);
  }
  #cartDrawer .aside-header {
    position: sticky; top: 0; z-index: 2;
    padding: 14px 16px;
    background: #fff;
    border-bottom: 1px solid #eef2f7;
  }
  .cdr-badge {
    display:inline-flex; align-items:center; justify-content:center;
    min-width: 22px; height: 22px; padding: 0 6px;
    font-size: 12px; font-weight: 700;
    color: #fff; background: #111827; border-radius: 999px;
  }
  .cart-drawer-items-list { padding: 12px 14px 132px; overflow: auto; }
  .cart-drawer-empty {
    text-align:center; color:#6b7280; padding: 32px 12px;
    border:1px dashed #e5e7eb; border-radius: 12px; background:#fafafa;
  }
  .cart-drawer-item {
    gap: 12px; padding: 10px; border:1px solid #eef2f7;
    border-radius: 14px; background: #fff;
    box-shadow: 0 1px 2px rgba(16,24,40,.04);
  }
  .cart-drawer-item + .cart-drawer-item { margin-top: 12px; }
  .cart-drawer-item__thumb {
    width: 72px; height: 72px; border-radius: 12px; overflow: hidden;
    background:#f9fafb; border:1px solid #eef2f7; flex: 0 0 72px;
  }
  .cart-drawer-item__thumb img { width:100%; height:100%; object-fit: cover; display:block; }
  .cart-drawer-item__title {
    margin: 0 0 6px 0; line-height: 1.35;
    font-size: 14px; font-weight: 700; color:#111827;
  }
  .cart-drawer-item__title a { color: inherit; text-decoration: none; }
  .cart-drawer-item__title a:hover { text-decoration: underline; }
  .cart-drawer-item__meta {
    display:flex; flex-wrap:wrap; gap:8px 12px; color:#6b7280; font-size:12px;
  }
  .cart-drawer-item__row {
    margin-top: 10px; display:flex; align-items:center; justify-content:space-between;
  }
  .qty-badge {
    font-size: 12px; font-weight: 700; color:#111827;
    background:#f3f4f6; border:1px solid #e5e7eb; padding:4px 10px; border-radius: 999px;
  }
  .price { font-weight: 800; color:#111827; }
  .btn-remove-line {
    position:absolute; top:8px; right:8px;
    width:28px; height:28px; display:inline-flex; align-items:center; justify-content:center;
    border-radius: 8px; border:1px solid #e5e7eb; background:#fff; cursor:pointer;
  }
  .btn-remove-line:hover { background:#f9fafb; }
  .cart-drawer-actions {
    background:#fff; border-top:1px solid #eef2f7;
    padding: 14px 16px 16px; box-shadow: 0 -6px 16px rgba(16,24,40,.06);
  }
  .cart-summary-row {
    display:flex; align-items:center; justify-content:space-between;
    font-weight: 700; color:#111827;
  }
  .cart-actions-stack .btn { height: 44px; border-radius: 12px; font-weight: 700; }
  .btn-primary { background:#111827; border-color:#111827; }
  .btn-primary:hover { filter:brightness(.95); }
  .btn-light { background:#f3f4f6; border-color:#e5e7eb; color:#111827; }
  @media (max-width: 480px){
    #cartDrawer { max-width: 100vw; }
    .cart-drawer-items-list { padding-bottom: 150px; }
  }
</style>

<div class="aside aside_right overflow-hidden cart-drawer" id="cartDrawer" role="dialog" aria-label="Gi·ªè h√†ng">
  <!-- Header -->
  <div class="aside-header d-flex align-items-center">
    <h3 class="text-uppercase fs-6 mb-0 d-flex align-items-center gap-2">
      <svg class="me-1" width="20" height="20" aria-hidden="true">
        <use href="/images/sprite.svg#icon_cart"></use>
      </svg>
      GI·ªé H√ÄNG
      <span class="cdr-badge js-cart-items-count"><%= cartCount || carts.length %></span>
    </h3>
    <button class="btn-close-lg js-close-aside btn-close-aside ms-auto" aria-label="ƒê√≥ng gi·ªè h√†ng"></button>
  </div>

  <!-- Items -->
  <div class="aside-content cart-drawer-items-list">
    <% if ((carts || []).length === 0) { %>
      <div class="cart-drawer-empty">
        <div class="mb-2" style="font-size:40px; line-height:1;">üõçÔ∏è</div>
        <div class="fw-semibold mb-1">Gi·ªè h√†ng tr·ªëng</div>
        <div class="small">Ti·∫øp t·ª•c mua s·∫Øm ƒë·ªÉ t√¨m m√≥n b·∫°n th√≠ch nh√©!</div>
      </div>
    <% } %>

    <% (carts || []).forEach((item) => { %>
      <div class="cart-drawer-item d-flex position-relative">
        <a class="cart-drawer-item__thumb" href="<%= item.productUrl %>" aria-label="<%= item.productName %>">
          <img loading="lazy" src="<%= item.imageUrl %>" alt="<%= item.productName %>">
        </a>

        <div class="cart-drawer-item__info flex-grow-1">
          <h6 class="cart-drawer-item__title">
            <a href="<%= item.productUrl %>"><%= item.productName %></a>
          </h6>

          <div class="cart-drawer-item__meta">
            <% if (item.colorName) { %>
              <span>M√†u: <strong><%= item.colorName %></strong></span>
            <% } %>
            <% if (item.sizeName) { %>
              <span>Size: <strong><%= item.sizeName %></strong></span>
            <% } %>
          </div>

          <div class="cart-drawer-item__row">
            <span class="qty-badge">x<%= item.quantity %></span>
            <span class="price">
              <%= (item.unitPrice * item.quantity).toLocaleString('vi-VN') %>
            </span>
          </div>
        </div>

        <!-- Remove -->
        <form method="post" action="/cart/remove/<%= item.idx %>">
          <button class="btn-remove-line js-cart-item-remove" title="Xo√° s·∫£n ph·∫©m n√†y" aria-label="Xo√°">
            <svg width="14" height="14" aria-hidden="true"><use href="/images/sprite.svg#icon_close"/></svg>
          </button>
        </form>
      </div>
    <% }) %>
  </div>

  <!-- Footer / Actions -->
  <div class="cart-drawer-actions position-absolute start-0 bottom-0 w-100">
    <div class="cart-summary-row mb-2">
      <span>T·ªïng gi√°</span>
      <span class="cart-subtotal"><%= total.toLocaleString('vi-VN') %></span>
    </div>
    <div class="cart-actions-stack">
      <a href="/shop-cart" class="btn btn-light d-block">Xem gi·ªè h√†ng</a>
      <a href="/shop-cart/checkout" class="btn btn-primary d-block mt-2">Thanh to√°n</a>
    </div>
  </div>
</div>
