<!DOCTYPE html>
<%- include('partials/head') %>

<body class="gradient-bg">
<%- include('partials/header') %>

<style>
  .mixi-upgrade-wrapper {
    font-family: "Poppins","Helvetica Neue",Arial,sans-serif;
  }
  .mixi-hero-overlay .slideshow-text {
    padding: 2rem 3rem;
    border-radius: 1.5rem;
    backdrop-filter: blur(6px);
    background: linear-gradient(135deg, rgba(20,22,38,0.82), rgba(8,8,18,0.78));
    box-shadow: 0 35px 80px rgba(10,12,30,0.35);
    color: #fff;
    width: min(62vw, 840px);
    text-align: left;
    left: 32% !important;
    transform: translate(-32%, -50%);
  }
  .mixi-hero-overlay .slideshow-text h2,
  .mixi-hero-overlay .slideshow-text h6 {
    color: #fff;
  }
  .mixi-hero-overlay .slideshow-text h6 {
    letter-spacing: 0.25rem;
    font-size: 0.8rem;
    opacity: 0.8;
  }
  .mixi-hero-overlay .slideshow-text h2 {
    letter-spacing: -0.02em;
    text-shadow: 0 8px 20px rgba(0,0,0,0.45);
  }
  .mixi-hero-overlay .text_dash {
    padding-left: 1.5rem;
  }
  .mixi-hero-overlay .text_dash::before {
    width: 0.85rem;
    left: 0;
    background-color: rgba(255,255,255,0.85);
  }
  .mixi-hero-overlay .btn-link_lg {
    padding: 0.85rem 1.5rem;
    border-radius: 999px;
    background: rgba(255,255,255,0.18);
    color: #fff;
    border: 1px solid rgba(255,255,255,0.35);
    transition: all 0.25s ease;
  }
  .mixi-hero-overlay .btn-link_lg:hover {
    background: #fff;
    color: #0d0e2c;
  }
  .mixi-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    padding: 0.35rem 0.85rem;
    border-radius: 999px;
    background: #eef2ff;
    color: #1d1f4d;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.1rem;
  }
  .mixi-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(180px,1fr));
    gap: 1rem;
  }
  .mixi-stats-card {
    background: #fff;
    border-radius: 1rem;
    padding: 1.5rem;
    box-shadow: 0 20px 55px rgba(14,24,45,0.08);
    text-align: center;
    transition: transform 0.25s ease, box-shadow 0.25s ease;
  }
  .mixi-stats-card strong {
    display: block;
    font-size: 2rem;
    margin-bottom: 0.25rem;
  }
  .mixi-stats-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 25px 70px rgba(10,16,38,0.12);
  }
  .mixi-latest-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
    gap: 1.25rem;
  }
  .mixi-latest-card {
    background: #fff;
    border-radius: 1.25rem;
    overflow: hidden;
    box-shadow: 0 18px 48px rgba(12,16,35,0.08);
    transition: transform 0.25s ease, box-shadow 0.25s ease;
  }
  .mixi-latest-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 25px 70px rgba(10,16,38,0.12);
  }
  .mixi-latest-card img {
    width: 100%;
    height: 220px;
    object-fit: cover;
  }
  .mixi-best-thumb {
    height: 260px;
    object-fit: cover;
    transition: transform 0.25s ease;
  }
  .mixi-latest-card:hover .mixi-best-thumb {
    transform: scale(1.02);
  }
  .mixi-status-pill {
    position: absolute;
    top: 1rem;
    left: 1rem;
    padding: 0.25rem 0.75rem;
    border-radius: 999px;
    background: rgba(13,18,54,0.85);
    color: #fff;
    font-size: 0.75rem;
    letter-spacing: 0.05em;
    text-transform: uppercase;
  }
  .mixi-latest-card__body {
    padding: 1.25rem;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  .mixi-product-card {
    background: #fff;
    border-radius: 1.25rem;
    box-shadow: 0 18px 48px rgba(15, 23, 42, 0.08);
    transition: transform 0.25s ease, box-shadow 0.25s ease;
    display: flex;
    flex-direction: column;
    height: 100%;
  }
  .mixi-product-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 25px 70px rgba(15, 23, 42, 0.14);
  }
  .mixi-product-thumb {
    position: relative;
    display: block;
    overflow: hidden;
    border-radius: 1.25rem 1.25rem 0 0;
    background: #f6f7fb;
  }
  .mixi-product-thumb img {
    width: 100%;
    height: 260px;
    object-fit: cover;
    display: block;
    transition: transform 0.35s ease, opacity 0.35s ease;
  }
  .mixi-product-thumb__hover {
    position: absolute;
    inset: 0;
    opacity: 0;
    z-index: 2;
  }
  .mixi-product-card:hover .mixi-product-thumb img:first-child {
    transform: scale(1.05);
  }
  .mixi-product-card:hover .mixi-product-thumb__hover {
    opacity: 1;
    transform: scale(1.02);
  }
  .mixi-product-body {
    padding: 1.25rem 1.35rem 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 0.55rem;
    height: 100%;
  }
  .mixi-product-meta {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: #94a3b8;
  }
  .mixi-product-title {
    font-size: 1rem;
    margin-bottom: 0;
  }
  .mixi-product-title a {
    color: #0f172a;
    text-decoration: none;
  }
  .mixi-product-desc {
    font-size: 0.9rem;
    color: #6b7280;
    min-height: 48px;
  }
  .mixi-rating {
    display: flex;
    align-items: center;
    gap: 0.45rem;
    flex-wrap: wrap;
  }
  .mixi-rating__value {
    font-weight: 700;
    color: #0f172a;
    font-size: 1rem;
  }
  .mixi-rating__stars {
    display: flex;
    gap: 0.1rem;
    font-size: 0.85rem;
    color: #cbd5f5;
  }
  .mixi-rating__star.is-active {
    color: #f6ad55;
  }
  .mixi-rating__count {
    font-size: 0.85rem;
    color: #64748b;
  }
  .mixi-color-swatches {
    display: flex;
    flex-wrap: wrap;
    gap: 0.4rem;
    margin-top: 0.35rem;
  }
  .mixi-swatch {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: 2px solid transparent;
    background-size: cover;
    background-position: center;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: border-color 0.2s ease, transform 0.2s ease;
    position: relative;
  }
  .mixi-swatch::after {
    content: "";
    width: 100%;
    height: 100%;
    border-radius: 50%;
    border: 1px solid rgba(255,255,255,0.6);
    position: absolute;
    inset: 0;
    pointer-events: none;
  }
  .mixi-swatch.is-active {
    border-color: #0f172a;
    transform: scale(1.05);
  }
  .mixi-swatch span {
    position: absolute;
    width: 1px;
    height: 1px;
    overflow: hidden;
    clip: rect(0 0 0 0);
    white-space: nowrap;
  }
  .mixi-product-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: auto;
  }
  .mixi-price {
    font-weight: 700;
    font-size: 1.1rem;
    color: #111827;
  }
  .mixi-product-badge {
    position: absolute;
    top: 1rem;
    right: 1rem;
    padding: 0.35rem 0.9rem;
    border-radius: 999px;
    background: rgba(15, 23, 42, 0.85);
    color: #fff;
    font-size: 0.72rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
  }
  .products-grid .mixi-product-thumb img,
  .products-grid .mixi-product-thumb__hover {
    height: 220px;
  }
  .mixi-subtle-btn {
    text-transform: uppercase;
    letter-spacing: 0.12rem;
    font-size: 0.8rem;
  }
  .mixi-brand-promise {
    background: #0f0f10;
    color: #fff;
    border-radius: 1.5rem;
    padding: 2rem;
    margin-top: 2rem;
    box-shadow: 0 25px 70px rgba(8,10,25,0.4);
  }
  .mixi-promise-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(200px,1fr));
    gap: 1.25rem;
  }
  .mixi-promise-card {
    background: rgba(255,255,255,0.06);
    border-radius: 1.1rem;
    padding: 1.25rem;
    height: 100%;
  }
  .mixi-promise-card h6 {
    margin-top: 0.75rem;
    margin-bottom: 0.35rem;
  }
</style>

<%
  const safeCategories = Array.isArray(categories) ? categories : [];
  const safeProducts = Array.isArray(products) ? products : [];
  const curatedShowcase = safeProducts.slice(0, 4);
  const bestSellerPool = safeProducts.filter((item) => {
    const statusName = (item?.productStatus?.statusName || "").toLowerCase();
    return statusName.includes("b√°n ch·∫°y") || statusName.includes("best");
  });
  const bestSellerShowcase = (bestSellerPool.length ? bestSellerPool : safeProducts).slice(0, 8);
%>

<main>
  <section class="swiper-container js-swiper-slider swiper-number-pagination slideshow h-xs-25rem mixi-hero-overlay"
           data-settings='{
        "autoplay": {
          "delay": 5000
        },
        "slidesPerView": 1,
        "effect": "fade",
        "loop": true
      }'>
    <div class="swiper-wrapper">
      <div class="swiper-slide">
        <div class="overflow-hidden position-relative h-100">
          <div class="slideshow-character position-absolute bottom-0 pos_right-center">
            <img loading="lazy" src="/mixishop/images/slideshow_mixigaming.png" width="542" height="733" alt="Woman Fashion 1" class="slideshow-character__img animate animate_fade animate_btt animate_delay-9 w-auto h-auto">
            <div class="character_markup type2">
              <p class="text-uppercase font-sofia mark-grey-color animate animate_fade animate_btt animate_delay-10 mb-0">Dresses</p>
            </div>
          </div>
          <div class="slideshow-text container position-absolute start-50 top-50 translate-middle">
            <h6 class="text_dash text-uppercase fs-base fw-medium animate animate_fade animate_btt animate_delay-3">New Arrivals</h6>
            <h2 class="h1 fw-normal mb-0 animate animate_fade animate_btt animate_delay-5">Night Spring</h2>
            <h2 class="h1 fw-bold animate animate_fade animate_btt animate_delay-5">Dresses</h2>
            <a href="shop1.html" class="btn-link btn-link_lg default-underline fw-medium animate animate_fade animate_btt animate_delay-7">Shop Now</a>
          </div>
        </div>
      </div><!-- /.slideshow-item -->

      <div class="swiper-slide">
        <div class="overflow-hidden position-relative h-100">
          <div class="slideshow-character position-absolute bottom-0 pos_right-center">
            <img loading="lazy" src="/mixishop/images/slideshow_qnt.png" width="400" height="733" alt="Woman Fashion 1" class="slideshow-character__img animate animate_fade animate_btt animate_delay-9 w-auto h-auto">
            <div class="character_markup">
              <p class="text-uppercase font-sofia fw-bold animate animate_fade animate_rtl animate_delay-10">Summer</p>
            </div>
          </div>
          <div class="slideshow-text container position-absolute start-50 top-50 translate-middle">
            <h6 class="text_dash text-uppercase fs-base fw-medium animate animate_fade animate_btt animate_delay-3">New Trend</h6>
            <h2 class="h1 fw-normal mb-0 animate animate_fade animate_btt animate_delay-5">Winter Sale Stylish</h2>
            <h2 class="h1 fw-bold animate animate_fade animate_btt animate_delay-5">Essentials</h2>
            <a href="shop1.html" class="btn-link btn-link_lg default-underline fw-medium animate animate_fade animate_btt animate_delay-7">Shop Now</a>
          </div>
        </div>
      </div><!-- /.slideshow-item -->

      <div class="swiper-slide">
        <div class="overflow-hidden position-relative h-100">
          <div class="slideshow-character position-absolute bottom-0 pos_right-center">
            <img loading="lazy" src="/mixishop/images/slideshow_djchip.png" width="400" height="690" alt="Woman Fashion 2" class="slideshow-character__img animate animate_fade animate_btt animate_delay-9 w-auto h-auto">
          </div>
          <div class="slideshow-text container position-absolute start-50 top-50 translate-middle">
            <h6 class="text_dash text-uppercase fs-base fw-medium animate animate_fade animate_btt animate_delay-3">New Arrivals</h6>
            <h2 class="h1 fw-normal mb-0 animate animate_fade animate_btt animate_delay-5">Top Selling</h2>
            <h2 class="h1 fw-bold animate animate_fade animate_btt animate_delay-5">Dresses</h2>
            <a href="shop1.html" class="btn-link btn-link_lg default-underline fw-medium animate animate_fade animate_btt animate_delay-7">Shop Now</a>
          </div>
        </div>
      </div><!-- /.slideshow-item -->
    </div><!-- /.slideshow-wrapper js-swiper-slider -->

    <div class="container">
      <div class="slideshow-pagination slideshow-number-pagination d-flex align-items-center position-absolute bottom-0 mb-5"></div>
      <!-- /.products-pagination -->
    </div><!-- /.container -->
  </section><!-- /.slideshow -->

  <section class="mixi-upgrade-wrapper container my-5 py-4">
    <div class="text-center mb-4">
      <span class="mixi-badge">Mixi Edition</span>
      <h2 class="mt-3">Chu·∫©n ho√° tr·∫£i nghi·ªám mua s·∫Øm c·ªßa b·∫°n</h2>
      <p class="text-muted mb-0">D·ªØ li·ªáu hi·ªÉn th·ªã tr·ª±c ti·∫øp t·ª´ backend (categories / products / latest / popular).</p>
    </div>
    <div class="mixi-stats-grid mb-4">
      <div class="mixi-stats-card">
        <strong><%= safeProducts.length %>+</strong>
        <span>S·∫£n ph·∫©m ƒëang ho·∫°t ƒë·ªông</span>
      </div>
      <div class="mixi-stats-card">
        <strong><%= safeCategories.length %></strong>
        <span>Danh m·ª•c n·ªïi b·∫≠t</span>
      </div>
      <div class="mixi-stats-card">
        <strong>72h</strong>
        <span>Th·ªùi gian giao trung b√¨nh</span>
      </div>
      <div class="mixi-stats-card">
        <strong>4.9/5</strong>
        <span>ƒêi·ªÉm h√†i l√≤ng kh√°ch h√†ng</span>
      </div>
    </div>

    <div class="mixi-latest-grid mb-4">
      <% curatedShowcase.forEach((item) => { %>
        <div class="mixi-latest-card">
          <img loading="lazy"
               src="<%= (item.colors && item.colors[0] && item.colors[0].imageUrls && item.colors[0].imageUrls[0]) ? item.colors[0].imageUrls[0] : '/images/default.png' %>"
               alt="<%= item.name %>">
          <div class="mixi-latest-card__body">
            <small class="text-uppercase text-muted"><%= item.brand?.name || "Mixi Original" %></small>
            <h6 class="mb-1"><a href="/product_detail/<%= item._id || item.id %>" class="text-dark"><%= item.name %></a></h6>
            <p class="text-muted small mb-2"><%= item.short_description || "Phi√™n b·∫£n gi·ªõi h·∫°n d√†nh ri√™ng cho c·ªông ƒë·ªìng Mixi." %></p>
            <div class="d-flex justify-content-between align-items-center">
              <span class="fw-semibold"><%= item.price ? new Intl.NumberFormat('vi-VN').format(item.price) + " ƒë" : "Gi√° c·∫≠p nh·∫≠t" %></span>
              <a href="/product_detail/<%= item._id || item.id %>" class="btn btn-sm btn-outline-primary mixi-subtle-btn">Chi ti·∫øt</a>
            </div>
          </div>
        </div>
      <% }) %>
    </div>

    <div class="mixi-brand-promise">
      <div class="d-flex flex-column flex-lg-row align-items-lg-center justify-content-between mb-3 gap-3">
        <div>
          <div class="mixi-badge mb-2">Mixi Service</div>
          <h3 class="mb-1">Gi√° tr·ªã b·∫°n nh·∫≠n ƒë∆∞·ª£c khi mua t·∫°i MixiShop</h3>
          <p class="text-white-50 mb-0">T·ª´ ch·∫•t l∆∞·ª£ng s·∫£n ph·∫©m t·ªõi d·ªãch v·ª• h·∫≠u m√£i, ch√∫ng t√¥i ƒë·ªÅ cao tr·∫£i nghi·ªám c·ªßa c·ªông ƒë·ªìng.</p>
        </div>
        <a href="/contact" class="btn btn-outline-light text-uppercase fw-semibold">Li√™n h·ªá CSKH</a>
      </div>
      <div class="mixi-promise-grid">
        <div class="mixi-promise-card">
          <div class="mixi-pillar__icon bg-white text-dark">üíØ</div>
          <h6>Ch√≠nh h√£ng 100%</h6>
          <p class="mb-0 text-white-50">S·∫£n ph·∫©m ƒë∆∞·ª£c s·∫£n xu·∫•t v√† ki·ªÉm duy·ªát tr·ª±c ti·∫øp b·ªüi MixiTeam.</p>
        </div>
        <div class="mixi-promise-card">
          <div class="mixi-pillar__icon bg-white text-dark">üßæ</div>
          <h6>Ho√†n ti·ªÅn linh ho·∫°t</h6>
          <p class="mb-0 text-white-50">ƒê·ªïi tr·∫£ ho·∫∑c ho√†n ti·ªÅn theo nhi·ªÅu ph∆∞∆°ng √°n ph√π h·ª£p v·ªõi nhu c·∫ßu c·ªßa b·∫°n.</p>
        </div>
        <div class="mixi-promise-card">
          <div class="mixi-pillar__icon bg-white text-dark">üì¶</div>
          <h6>ƒê√≥ng g√≥i k·ªπ l∆∞·ª°ng</h6>
          <p class="mb-0 text-white-50">M·ªói ƒë∆°n ƒë∆∞·ª£c b·ªçc ch·ªëng s·ªëc v√† k√®m ch·ªØ k√Ω QC ƒë·ªÉ ƒë·∫£m b·∫£o nguy√™n tr·∫°ng.</p>
        </div>
        <div class="mixi-promise-card">
          <div class="mixi-pillar__icon bg-white text-dark">ü´∂</div>
          <h6>H·ªó tr·ª£ c·ªông ƒë·ªìng</h6>
          <p class="mb-0 text-white-50">M·ªôt ph·∫ßn l·ª£i nhu·∫≠n ƒë∆∞·ª£c d√πng ƒë·ªÉ t·ªï ch·ª©c ho·∫°t ƒë·ªông thi·ªán nguy·ªán c√πng MixiFan.</p>
        </div>
      </div>
    </div>
  </section>

  <div class="container mw-1620 bg-white border-radius-10">
    <div class="mb-3 mb-xl-5 pt-1 pb-4"></div>
    <section class="category-carousel container">
      
      
      <h2 class="section-title text-center mb-3 pb-xl-2 mb-xl-4">ƒê·ªí HI·ªÜU MIXI</h2>

      <div class="position-relative">
        <div class="swiper-container js-swiper-slider"
             data-settings='{
              "autoplay": {
                "delay": 5000
              },
              "slidesPerView": 8,
              "slidesPerGroup": 1,
              "effect": "none",
              "loop": true,
              "navigation": {
                "nextEl": ".products-carousel__next-1",
                "prevEl": ".products-carousel__prev-1"
              },
              "breakpoints": {
                "320": {
                  "slidesPerView": 2,
                  "slidesPerGroup": 2,
                  "spaceBetween": 15
                },
                "768": {
                  "slidesPerView": 4,
                  "slidesPerGroup": 4,
                  "spaceBetween": 30
                },
                "992": {
                  "slidesPerView": 6,
                  "slidesPerGroup": 1,
                  "spaceBetween": 45,
                  "pagination": false
                },
                "1200": {
                  "slidesPerView": 8,
                  "slidesPerGroup": 1,
                  "spaceBetween": 60,
                  "pagination": false
                }
              }
            }'>
          <div class="swiper-wrapper">
            <% categories.forEach(category => { %>
              <div class="swiper-slide">
                <a href="/category/<%= category._id %>" class="d-block">
                  <img loading="lazy" class="w-100 h-auto mb-3" src="<%= category.image%>" width="150" height="150" alt="">
                  <div class="text-center">
                    <a class="menu-link fw-medium"><%= category.name %></a>
                  </div>
                </a>
              </div>
            <% }) %>
          </div>



        </div><!-- /.swiper-wrapper -->
      </div><!-- /.swiper-container js-swiper-slider -->

      <div class="products-carousel__prev products-carousel__prev-1 position-absolute top-50 d-flex align-items-center justify-content-center">
        <svg width="25" height="25" viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg"><use href="#icon_prev_md" /></svg>
      </div><!-- /.products-carousel__prev -->
      <div class="products-carousel__next products-carousel__next-1 position-absolute top-50 d-flex align-items-center justify-content-center">
        <svg width="25" height="25" viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg"><use href="#icon_next_md" /></svg>
      </div><!-- /.products-carousel__next -->
    </section>

    <div class="mb-3 mb-xl-5 pt-1 pb-4"></div>

    <section class="hot-deals container">
      <h2 class="section-title text-center mb-3 pb-xl-3 mb-xl-4">Hot Trending</h2>
      <div class="row">
        <div class="col-md-6 col-lg-4 col-xl-20per d-flex align-items-center flex-column justify-content-center py-4 align-items-md-start">
          <h2>Si√™u h·∫•p d·∫´n</h2>
          <h2 class="fw-bold">S·∫£n ph·∫©m t·ª´ nh√† MixiShop</h2>

          <div class="position-relative d-flex align-items-center text-center pt-xxl-4 js-countdown mb-3" data-date="18-5-2024" data-time="06:50">
            <div class="day countdown-unit">
              <span class="countdown-num d-block"></span>
              <span class="countdown-word text-uppercase text-secondary">Days</span>
            </div>

            <div class="hour countdown-unit">
              <span class="countdown-num d-block"></span>
              <span class="countdown-word text-uppercase text-secondary">Hours</span>
            </div>

            <div class="min countdown-unit">
              <span class="countdown-num d-block"></span>
              <span class="countdown-word text-uppercase text-secondary">Mins</span>
            </div>

            <div class="sec countdown-unit">
              <span class="countdown-num d-block"></span>
              <span class="countdown-word text-uppercase text-secondary">Sec</span>
            </div>
          </div>

          <a href="shop1.html" class="btn-link default-underline text-uppercase fw-medium mt-3">Xem t·∫•t c·∫£</a>
        </div>
        <div class="col-md-6 col-lg-8 col-xl-80per">
          <div class="position-relative">
            <div class="swiper-container js-swiper-slider"
                 data-settings='{
                  "autoplay": {
                    "delay": 5000,
                    "disableOnInteraction": false
                  },
                  "slidesPerView": 4,
                  "slidesPerGroup": 4,
                  "effect": "none",
                  "loop": true,
                  "navigation": {
                    "nextEl": ".products-carousel__next-2",
                    "prevEl": ".products-carousel__prev-2"
                  },
                  "breakpoints": {
                    "320": { "slidesPerView": 2, "slidesPerGroup": 2, "spaceBetween": 14 },
                    "768": { "slidesPerView": 2, "slidesPerGroup": 3, "spaceBetween": 24 },
                    "992": { "slidesPerView": 3, "slidesPerGroup": 1, "spaceBetween": 30 },
                    "1200": { "slidesPerView": 4, "slidesPerGroup": 1, "spaceBetween": 30 }
                  }
                }'>
              <div class="swiper-wrapper">
        <% (products.length > 5 ? products.slice(0, 5) : products).forEach(product => { 
             const colorOptions = Array.isArray(product.colors) ? product.colors : [];
             const firstColor = colorOptions.length ? colorOptions[0] : null;
             const mainImage = firstColor && firstColor.imageUrls && firstColor.imageUrls[0] ? firstColor.imageUrls[0] : '/images/default.png';
             const hoverImage = firstColor && firstColor.imageUrls && firstColor.imageUrls[1] ? firstColor.imageUrls[1] : mainImage;
             const avgRating = Number(product.avg_rating || 0);
             const safeAvg = Number.isFinite(avgRating) ? avgRating : 0;
             const reviewCount = Number(product.rating_count || product.total_reviews || 0);
             const safeReview = Number.isFinite(reviewCount) ? reviewCount : 0;
                %>
                  <div class="swiper-slide">
            <article class="mixi-product-card" data-product-id="hot-<%= product._id %>">
                      <a href="/product_detail/<%= product._id %>" class="mixi-product-thumb">
                        <img loading="lazy" src="<%= mainImage %>" alt="<%= product.name %>">
                        <img loading="lazy" src="<%= hoverImage %>" alt="<%= product.name %>" class="mixi-product-thumb__hover">
                        <span class="mixi-product-badge">Hot trend</span>
                      </a>
                      <div class="mixi-product-body">
                        <span class="mixi-product-meta"><%= product.brand?.name || 'Mixi Original' %></span>
                        <h3 class="mixi-product-title">
                          <a href="/product_detail/<%= product._id %>"><%= product.name %></a>
                        </h3>
                        <p class="mixi-product-desc"><%= product.short_description || 'Phi√™n b·∫£n gi·ªõi h·∫°n d√†nh cho c·ªông ƒë·ªìng Mixi.' %></p>
                        <div class="mixi-rating">
                          <span class="mixi-rating__value"><%= safeAvg.toFixed(1) %></span>
                          <div class="mixi-rating__stars">
                            <% for (let i = 1; i <= 5; i++) { %>
                              <span class="mixi-rating__star <%= i <= Math.round(safeAvg) ? 'is-active' : '' %>">‚òÖ</span>
                            <% } %>
                          </div>
                          <span class="mixi-rating__count"><%= safeReview %> ƒë√°nh gi√°</span>
                        </div>
                <% if (colorOptions.length) { %>
                  <div class="mixi-color-swatches">
                    <% colorOptions.slice(0, 6).forEach((productColor, idx) => { 
                         const imgs = Array.isArray(productColor.imageUrls) ? productColor.imageUrls.filter(Boolean) : [];
                         const preview = imgs.length ? imgs[0] : '/images/default.png';
                         const second = imgs[1] || imgs[0] || preview;
                    %>
                      <button type="button"
                              class="mixi-swatch <%= idx === 0 ? 'is-active' : '' %>"
                              data-product-target="hot-<%= product._id %>"
                              data-images="<%= [preview, second].filter(Boolean).map(encodeURI).join('|') %>"
                              style="background-image:url('<%= encodeURI(preview) %>')"
                              aria-label="M√†u <%= productColor.color || productColor.color_id?.color_name || '' %>">
                        <span><%= productColor.color || productColor.color_id?.color_name || '' %></span>
                      </button>
                    <% }) %>
                  </div>
                <% } %>
                        <div class="mixi-product-footer">
                          <span class="mixi-price"><%= (typeof product.price === "number" ? new Intl.NumberFormat('vi-VN').format(product.price) + " ƒë" : "Gi√° c·∫≠p nh·∫≠t") %></span>
                          <a href="/product_detail/<%= product._id %>" class="btn btn-outline-dark btn-sm rounded-pill">Mua ngay</a>
                        </div>
                      </div>
                    </article>
                  </div>
                <% }) %>
              </div>


            </div><!-- /.swiper-container js-swiper-slider -->
            <!-- N√∫t Prev -->
            <div class="products-carousel__prev products-carousel__prev-2 position-absolute top-50 start-0 d-flex align-items-center justify-content-center">
              <svg width="25" height="25" viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg">
                <use href="#icon_prev_md" />
              </svg>
            </div>

            <!-- N√∫t Next -->
            <div class="products-carousel__next products-carousel__next-2 position-absolute top-50 end-0 d-flex align-items-center justify-content-center">
              <svg width="25" height="25" viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg">
                <use href="#icon_next_md" />
              </svg>
            </div>

          </div><!-- /.position-relative -->
        </div>
      </div>
    </section>

    <div class="mb-3 mb-xl-5 pt-1 pb-4"></div>

    <section class="category-banner container">
      <div class="row">
        <div class="col-md-6">
          <div class="category-banner__item border-radius-10 mb-5">

            <img loading="lazy" class="h-auto" src="/mixishop/images/tuitenbo.jpg" width="690" height="665" alt="">
            <div class="category-banner__item-mark">
              Si√™u gi·∫£m gi√°
            </div>
            <div class="category-banner__item-content">
              <h3 class="mb-0">B√°n ch·∫°y</h3>
              <a href="shop1.html" class="btn-link default-underline text-uppercase fw-medium">Mua ngay</a>
            </div>
          </div>
          <div class="pb-2"></div>
        </div>
        <div class="col-md-6">
          <div class="category-banner__item border-radius-10 mb-5">
            <img loading="lazy" class="h-auto" src="/mixishop/images/mixi_coc.jpg" width="690" height="665" alt="">
            <div class="category-banner__item-mark">
              Tuy·ªát l√† v·ªùi
            </div>
            <div class="category-banner__item-content">
              <h3 class="mb-0">H√†ng m·ªõi</h3>
              <a href="shop1.html" class="btn-link default-underline text-uppercase fw-medium">Mua ngay</a>
            </div>
          </div>
          <div class="pb-2"></div>
        </div>
      </div>
    </section>

    <div class="mb-3 mb-xl-5 pt-1 pb-4"></div>
    <section class="products-grid container">
      <h2 class="section-title text-center mb-3 pb-xl-3 mb-xl-4">Danh m·ª•c s·∫£n ph·∫©m</h2>

      <div class="row">

        <% (products.length > 16 ? products.slice(0, 16) : products).forEach(product_list => { 
             const colorList = Array.isArray(product_list.colors) ? product_list.colors : [];
             const firstColorList = colorList.length ? colorList[0] : null;
             const mainImageList = firstColorList && firstColorList.imageUrls && firstColorList.imageUrls[0] ? firstColorList.imageUrls[0] : '/images/default.png';
             const hoverImageList = firstColorList && firstColorList.imageUrls && firstColorList.imageUrls[1] ? firstColorList.imageUrls[1] : mainImageList;
             const avgList = Number(product_list.avg_rating || 0);
             const safeAvgList = Number.isFinite(avgList) ? avgList : 0;
             const reviewList = Number(product_list.rating_count || product_list.total_reviews || 0);
             const safeReviewList = Number.isFinite(reviewList) ? reviewList : 0;
             const statusLabel = product_list.productStatus?.statusName || null;
             const detailUrl = `/product_detail/${product_list._id || product_list.id}`;
             const priceLabel = typeof product_list.price === "number"
               ? new Intl.NumberFormat('vi-VN').format(product_list.price) + " ƒë"
               : (product_list.getFormattedPrice ? product_list.getFormattedPrice(product_list.price) : "Li√™n h·ªá");
        %>
          <div class="col-6 col-md-4 col-lg-3">
            <article class="mixi-product-card mb-3 mb-md-4 mb-xxl-5" data-product-id="grid-<%= product_list._id || product_list.id %>">
              <a href="<%= detailUrl %>" class="mixi-product-thumb">
                <img loading="lazy" src="<%= mainImageList %>" alt="<%= product_list.name %>">
                <img loading="lazy" src="<%= hoverImageList %>" alt="<%= product_list.name %>" class="mixi-product-thumb__hover">
                <% if (statusLabel) { %>
                  <span class="mixi-product-badge"><%= statusLabel %></span>
                <% } %>
              </a>
              <div class="mixi-product-body">
                <span class="mixi-product-meta"><%= product_list.brand?.name || product_list.category?.name || 'Mixi Original' %></span>
                <h3 class="mixi-product-title">
                  <a href="<%= detailUrl %>"><%= product_list.name %></a>
                </h3>
                <p class="mixi-product-desc"><%= product_list.short_description || 'Thi·∫øt k·∫ø ƒë·ªôc quy·ªÅn MixiShop.' %></p>
                <div class="mixi-rating">
                  <span class="mixi-rating__value"><%= safeAvgList.toFixed(1) %></span>
                  <div class="mixi-rating__stars">
                    <% for (let i = 1; i <= 5; i++) { %>
                      <span class="mixi-rating__star <%= i <= Math.round(safeAvgList) ? 'is-active' : '' %>">‚òÖ</span>
                    <% } %>
                  </div>
                  <span class="mixi-rating__count"><%= safeReviewList %> ƒë√°nh gi√°</span>
                </div>
                <% if (colorList.length) { %>
                  <div class="mixi-color-swatches">
                    <% colorList.slice(0, 6).forEach((productColor, idx) => { 
                         const imgs = Array.isArray(productColor.imageUrls) ? productColor.imageUrls.filter(Boolean) : [];
                         const preview = imgs.length ? imgs[0] : '/images/default.png';
                         const second = imgs[1] || imgs[0] || preview;
                    %>
                      <button type="button"
                              class="mixi-swatch <%= idx === 0 ? 'is-active' : '' %>"
                              data-product-target="grid-<%= product_list._id || product_list.id %>"
                              data-images="<%= [preview, second].filter(Boolean).map(encodeURI).join('|') %>"
                              style="background-image:url('<%= encodeURI(preview) %>')"
                              aria-label="M√†u <%= productColor.color || productColor.color_id?.color_name || '' %>">
                        <span><%= productColor.color || productColor.color_id?.color_name || '' %></span>
                      </button>
                    <% }) %>
                  </div>
                <% } %>
                <div class="mixi-product-footer">
                  <span class="mixi-price"><%= priceLabel %></span>
                  <a href="<%= detailUrl %>" class="btn btn-sm btn-outline-dark rounded-pill">Xem chi ti·∫øt</a>
                </div>
              </div>
            </article>
          </div>
        <% }) %>

      </div><!-- /.row -->

      <div class="text-center mt-2">
        <a class="btn-link btn-link_lg default-underline text-uppercase fw-medium" href="/category/alls">Xem t·∫•t c·∫£</a>
      </div>
    </section>

    <section class="container my-5">
      <div class="d-flex flex-column flex-lg-row align-items-lg-center justify-content-between mb-4 gap-3">
        <div>
          <span class="mixi-badge">Best Sellers</span>
          <h2 class="mt-3 mb-0">S·∫£n ph·∫©m b√°n ch·∫°y</h2>
          <p class="text-muted mb-0">T·ªïng h·ª£p c√°c item c√≥ tr·∫°ng th√°i ‚ÄúB√°n ch·∫°y‚Äù, ƒë∆∞·ª£c c·ªông ƒë·ªìng quan t√¢m nhi·ªÅu nh·∫•t.</p>
        </div>
        <a href="/category/alls?sort=price_high_to_low" class="btn btn-outline-dark px-4 rounded-pill">Xem t·∫•t c·∫£</a>
      </div>
      <div class="row g-4">
        <% bestSellerShowcase.forEach((product) => { 
             const colorBest = Array.isArray(product.colors) ? product.colors : [];
             const firstColor = colorBest.length ? colorBest[0] : null;
             const firstImg = firstColor && Array.isArray(firstColor.imageUrls) && firstColor.imageUrls.length ? firstColor.imageUrls[0] : '/images/default.png';
             const secondaryImg = firstColor && Array.isArray(firstColor.imageUrls) && firstColor.imageUrls[1] ? firstColor.imageUrls[1] : firstImg;
             const badge = product.productStatus?.statusName || 'B√°n ch·∫°y';
             const avgBest = Number(product.avg_rating || 0);
             const safeAvgBest = Number.isFinite(avgBest) ? avgBest : 0;
             const reviewBest = Number(product.rating_count || product.total_reviews || 0);
             const safeReviewBest = Number.isFinite(reviewBest) ? reviewBest : 0;
             const detailUrlBest = `/product_detail/${product._id || product.id}`;
        %>
          <div class="col-12 col-sm-6 col-xl-3">
            <article class="mixi-product-card h-100" data-product-id="best-<%= product._id || product.id %>">
              <a href="<%= detailUrlBest %>" class="mixi-product-thumb">
                <img loading="lazy" class="mixi-best-thumb" src="<%= firstImg %>" alt="<%= product.name %>">
                <img loading="lazy" class="mixi-product-thumb__hover" src="<%= secondaryImg %>" alt="<%= product.name %>">
                <span class="mixi-status-pill"><%= badge %></span>
              </a>
              <div class="mixi-product-body">
                <small class="mixi-product-meta d-block"><%= product.brand?.name || 'Mixi Original' %></small>
                <h6 class="mixi-product-title">
                  <a href="<%= detailUrlBest %>" class="text-dark text-decoration-none"><%= product.name %></a>
                </h6>
                <p class="mixi-product-desc"><%= product.short_description || 'Phi√™n b·∫£n ƒë∆∞·ª£c sƒÉn ƒë√≥n nhi·ªÅu nh·∫•t tu·∫ßn n√†y.' %></p>
                <div class="mixi-rating">
                  <span class="mixi-rating__value"><%= safeAvgBest.toFixed(1) %></span>
                  <div class="mixi-rating__stars">
                    <% for (let i = 1; i <= 5; i++) { %>
                      <span class="mixi-rating__star <%= i <= Math.round(safeAvgBest) ? 'is-active' : '' %>">‚òÖ</span>
                    <% } %>
                  </div>
                  <span class="mixi-rating__count"><%= safeReviewBest %> ƒë√°nh gi√°</span>
                </div>
                <% if (colorBest.length) { %>
                  <div class="mixi-color-swatches">
                    <% colorBest.slice(0, 6).forEach((productColor, idx) => { 
                         const imgs = Array.isArray(productColor.imageUrls) ? productColor.imageUrls.filter(Boolean) : [];
                         const preview = imgs.length ? imgs[0] : '/images/default.png';
                         const second = imgs[1] || imgs[0] || preview;
                    %>
                      <button type="button"
                              class="mixi-swatch <%= idx === 0 ? 'is-active' : '' %>"
                              data-product-target="best-<%= product._id || product.id %>"
                              data-images="<%= [preview, second].filter(Boolean).map(encodeURI).join('|') %>"
                              style="background-image:url('<%= encodeURI(preview) %>')"
                              aria-label="M√†u <%= productColor.color || productColor.color_id?.color_name || '' %>">
                        <span><%= productColor.color || productColor.color_id?.color_name || '' %></span>
                      </button>
                    <% }) %>
                  </div>
                <% } %>
                <div class="mixi-product-footer">
                  <span class="mixi-price">
                    <%= product.price ? new Intl.NumberFormat('vi-VN').format(product.price) + " ƒë" : "Gi√° c·∫≠p nh·∫≠t" %>
                  </span>
                  <a href="<%= detailUrlBest %>" class="btn btn-sm btn-outline-primary rounded-pill">Chi ti·∫øt</a>
                </div>
              </div>
            </article>
          </div>
        <% }) %>
      </div>
    </section>
  </div>

  <div class="mb-3 mb-xl-5 pt-1 pb-4"></div>

  <section class="instagram px-1 position-relative">
    <h2 class="d-none">Instagram</h2>
    <div class="row row-cols-2 row-cols-md-4 row-cols-xl-8">
      <div class="instagram__tile">
        <a href="https://instagram.com/" target="_blank" class="position-relative overflow-hidden d-block effect overlay-plus">
          <img loading="lazy" class="instagram__img" src="/mixishop/images/instagram/insta5.jpg" width="232" height="232" alt="Insta image 5">
        </a>
      </div>
      <div class="instagram__tile">
        <a href="https://instagram.com/" target="_blank" class="position-relative overflow-hidden d-block effect overlay-plus">
          <img loading="lazy" class="instagram__img" src="/mixishop/images/instagram/insta7.jpg" width="232" height="232" alt="Insta image 7">
        </a>
      </div>
      <div class="instagram__tile">
        <a href="https://instagram.com/" target="_blank" class="position-relative overflow-hidden d-block effect overlay-plus">
          <img loading="lazy" class="instagram__img" src="/mixishop/images/instagram/insta8.jpg" width="232" height="232" alt="Insta image 8">
        </a>
      </div>
      <div class="instagram__tile">
        <a href="https://instagram.com/" target="_blank" class="position-relative overflow-hidden d-block effect overlay-plus">
          <img loading="lazy" class="instagram__img" src="/mixishop/images/instagram/insta9.jpg" width="232" height="232" alt="Insta image 9">
        </a>
      </div>
      <div class="instagram__tile">
        <a href="https://instagram.com/" target="_blank" class="position-relative overflow-hidden d-block effect overlay-plus">
          <img loading="lazy" class="instagram__img" src="/mixishop/images/instagram/insta10.jpg" width="232" height="232" alt="Insta image 10">
        </a>
      </div>
      <div class="instagram__tile">
        <a href="https://instagram.com/" target="_blank" class="position-relative overflow-hidden d-block effect overlay-plus">
          <img loading="lazy" class="instagram__img" src="/mixishop/images/instagram/insta11.jpg" width="232" height="232" alt="Insta image 11">
        </a>
      </div>
      <div class="instagram__tile">
        <a href="https://instagram.com/" target="_blank" class="position-relative overflow-hidden d-block effect overlay-plus">
          <img loading="lazy" class="instagram__img" src="/mixishop/images/instagram/insta12.jpg" width="232" height="232" alt="Insta image 12">
        </a>
      </div>
      <div class="instagram__tile">
        <a href="https://instagram.com/" target="_blank" class="position-relative overflow-hidden d-block effect overlay-plus">
          <img loading="lazy" class="instagram__img" src="/mixishop/images/instagram/insta6.jpg" width="232" height="232" alt="Insta image 6">
        </a>
      </div>
    </div>
    <button class="btn position-absolute position-center fw-medium px-4 d-flex align-items-center gap-2">
      <svg class="svg-icon svg-icon_instagram" width="14" height="13" viewBox="0 0 14 13" xmlns="http://www.w3.org/2000/svg">
        <path d="M7.125 3.2959C5.375 3.2959 3.98047 4.71777 3.98047 6.44043C3.98047 8.19043 5.375 9.58496 7.125 9.58496C8.84766 9.58496 10.2695 8.19043 10.2695 6.44043C10.2695 4.71777 8.84766 3.2959 7.125 3.2959ZM7.125 8.49121C6.00391 8.49121 5.07422 7.58887 5.07422 6.44043C5.07422 5.31934 5.97656 4.41699 7.125 4.41699C8.24609 4.41699 9.14844 5.31934 9.14844 6.44043C9.14844 7.58887 8.24609 8.49121 7.125 8.49121ZM11.1172 3.18652C11.1172 2.77637 10.7891 2.44824 10.3789 2.44824C9.96875 2.44824 9.64062 2.77637 9.64062 3.18652C9.64062 3.59668 9.96875 3.9248 10.3789 3.9248C10.7891 3.9248 11.1172 3.59668 11.1172 3.18652ZM13.1953 3.9248C13.1406 2.94043 12.9219 2.06543 12.2109 1.35449C11.5 0.643555 10.625 0.424805 9.64062 0.370117C8.62891 0.31543 5.59375 0.31543 4.58203 0.370117C3.59766 0.424805 2.75 0.643555 2.01172 1.35449C1.30078 2.06543 1.08203 2.94043 1.02734 3.9248C0.972656 4.93652 0.972656 7.97168 1.02734 8.9834C1.08203 9.96777 1.30078 10.8154 2.01172 11.5537C2.75 12.2646 3.59766 12.4834 4.58203 12.5381C5.59375 12.5928 8.62891 12.5928 9.64062 12.5381C10.625 12.4834 11.5 12.2646 12.2109 11.5537C12.9219 10.8154 13.1406 9.96777 13.1953 8.9834C13.25 7.97168 13.25 4.93652 13.1953 3.9248ZM11.8828 10.0498C11.6914 10.5967 11.2539 11.0068 10.7344 11.2256C9.91406 11.5537 8 11.4717 7.125 11.4717C6.22266 11.4717 4.30859 11.5537 3.51562 11.2256C2.96875 11.0068 2.55859 10.5967 2.33984 10.0498C2.01172 9.25684 2.09375 7.34277 2.09375 6.44043C2.09375 5.56543 2.01172 3.65137 2.33984 2.83105C2.55859 2.31152 2.96875 1.90137 3.51562 1.68262C4.30859 1.35449 6.22266 1.43652 7.125 1.43652C8 1.43652 9.91406 1.35449 10.7344 1.68262C11.2539 1.87402 11.6641 2.31152 11.8828 2.83105C12.2109 3.65137 12.1289 5.56543 12.1289 6.44043C12.1289 7.34277 12.2109 9.25684 11.8828 10.0498Z"></path>
      </svg>
      <span>Instagram</span>
    </button>
  </section><!-- /.instagram container -->

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const mainEl = document.querySelector('main');
      const productsSection = document.querySelector('section.products-grid');
      const instagramSection = document.querySelector('section.instagram');
      if (mainEl && productsSection) {
        mainEl.appendChild(productsSection);
      }
      if (mainEl && instagramSection) {
        mainEl.appendChild(instagramSection);
      }
    });
  </script>
</main>

<hr class="mt-2 text-secondary">

    <%- include('partials/footer') %>
    <%- include('partials/icons') %>
    <%- include('partials/login_form') %>
    <%- include('partials/cart_drawer') %>
    <%- include('partials/quick_view') %>
    <%- include('partials/sitemap') %>

<!-- Go To Top -->
<div id="scrollTop" class="visually-hidden end-0"></div>

<!-- Page Overlay -->
<div class="page-overlay"></div><!-- /.page-overlay -->


<!--  &lt;!&ndash; External JavaScripts &ndash;&gt;-->
<script src="/mixishop/js/plugins/jquery.min.js"></script>
<script src="/mixishop/js/plugins/bootstrap.bundle.min.js"></script>
<script src="/mixishop/js/plugins/bootstrap-slider.min.js"></script>

<script src="/mixishop/js/plugins/swiper.min.js"></script>
<script src="/mixishop/js/plugins/countdown.js"></script>

<!-- Footer Scripts -->
<script src="/mixishop/js/theme.js"></script>

<script>
  function changeColor(swatch) {
    const dataImages = swatch.getAttribute('data-images');
    const images = dataImages ? dataImages.split('|') : [];

    const productCard = swatch.closest('.product-card');

    const firstImage = productCard.querySelector('.pc__img');
    const secondImage = productCard.querySelector('.pc__img-second');

    if (!firstImage || !secondImage) {
      console.error('Kh√¥ng t√¨m th·∫•y ph·∫ßn t·ª≠ .pc__img ho·∫∑c .pc__img-second trong s·∫£n ph·∫©m');
      return;
    }

    if (images.length > 0) {
      firstImage.src = images[0];
      secondImage.src = images.length > 1 ? images[1] : images[0];
    } else {
      firstImage.src = 'path/to/default/image.png';
      secondImage.src = 'path/to/default/image.png';
    }

    const swatchColors = productCard.querySelectorAll('.swatch-color');
    swatchColors.forEach(color => color.classList.remove('swatch_active'));
    swatch.classList.add('swatch_active');
  }

  document.addEventListener('DOMContentLoaded', () => {
    const mainEl = document.querySelector('main');
    const productSection = document.querySelector('section.products-grid');
    const instagramSection = document.querySelector('section.instagram');
    if (mainEl && productSection) {
      mainEl.appendChild(productSection);
    }
    if (mainEl && instagramSection) {
      mainEl.appendChild(instagramSection);
    }
  });

  document.addEventListener('click', (event) => {
    const swatch = event.target.closest('.mixi-swatch');
    if (!swatch) return;
    event.preventDefault();
    const targetId = swatch.dataset.productTarget;
    const card = targetId ? document.querySelector(`[data-product-id="${targetId}"]`) : swatch.closest('.mixi-product-card');
    if (!card) return;
    const images = (swatch.dataset.images || '').split('|').map(decodeURIComponent).filter(Boolean);
    const thumbImages = card.querySelectorAll('.mixi-product-thumb img');
    if (thumbImages.length) {
      if (images[0]) thumbImages[0].src = images[0];
      if (thumbImages[1]) thumbImages[1].src = images[1] || images[0] || thumbImages[1].src;
    }
    const related = document.querySelectorAll(`.mixi-swatch[data-product-target="${targetId}"]`);
    (related.length ? related : card.querySelectorAll('.mixi-swatch')).forEach((btn) => btn.classList.remove('is-active'));
    swatch.classList.add('is-active');
  });
</script>

</body>

<!-- Mirrored from uomo-html.flexkitux.com/Demo3/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 19 Oct 2024 06:53:32 GMT -->
</html>