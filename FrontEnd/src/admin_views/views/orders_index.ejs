<% layout('layouts/admin') %>
  <section class="space-y-6">
    <!-- Header -->
    <div class="flex items-center justify-between">
      <h2 class="text-xl font-semibold tracking-tight text-slate-900">Đơn hàng</h2>
    </div>

    <!-- Table Card -->
    <div class="rounded-2xl border p-4 border-slate-200 bg-white shadow-sm overflow-hidden">
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead class="sticky top-0 z-10 bg-slate-50/95 backdrop-blur supports-[backdrop-filter]:bg-slate-50/80">
            <tr class="text-left text-slate-500 uppercase text-[11px]">
              <th class="p-3">Mã đơn</th>
              <th class="p-3">Khách hàng</th>
              <th class="p-3">Ngày đặt</th>
              <th class="p-3 text-right">Thành tiền</th>
              <th class="p-3">Mã giảm</th>
              <th class="p-3">Trạng thái</th>
              <th class="p-3 w-24"></th>
            </tr>
          </thead>

          <tbody>
            <% (items||[]).forEach(o=>{ %>
              <tr class="border-t odd:bg-white even:bg-slate-50/40 hover:bg-indigo-50/40 transition-colors">
                <td class="p-3 font-medium text-slate-900 whitespace-nowrap">
                  <span class="font-mono text-xs bg-slate-100 px-2 py-1 rounded-md ring-1 ring-slate-200">
                    <%= o._id %>
                  </span>
                </td>

                <td class="p-3 whitespace-nowrap max-w-[280px]">
                  <div class="truncate text-slate-700">
                    <%= (o.user && o.user.full_name) || 'Guest' %>
                  </div>
                </td>

                <td class="p-3 whitespace-nowrap">
                  <span class="text-slate-700">
                    <%= new Date(o.createdAt).toLocaleString('vi-VN') %>
                  </span>
                </td>

                <td class="p-3 text-right whitespace-nowrap">
                  <span class="tabular-nums font-semibold text-slate-900">
                    <%= (o.final_amount||0).toLocaleString('vi-VN',{style:'currency',currency:'VND'}) %>
                  </span>
                </td>

                <td class="p-3 whitespace-nowrap">
                  <% const code=(o.discount_code && o.discount_code.code) || '—' %>
                    <span
                      class="inline-flex items-center rounded-md px-2 py-0.5 text-xs ring-1
                             <%= code==='—' ? 'text-slate-500 ring-slate-200 bg-slate-50' : 'text-indigo-700 ring-indigo-200 bg-indigo-50' %>">
                      <%= code %>
                    </span>
                </td>

                <td class="p-3 whitespace-nowrap">
                  <%- include('partials/_statusBadge', {status:o.current_status}) %>
                </td>

                <td class="p-3 text-right">
                  <a class="inline-flex items-center justify-center rounded-lg bg-blue-600 px-2.5 py-1.5 text-xs font-medium text-white shadow-sm hover:bg-blue-700"
                    href="/admin/orders/<%= o._id %>">
                    Chi tiết
                  </a>
                </td>
              </tr>
              <% }) %>
          </tbody>
        </table>
      </div>

      <div class="border-t">
        <%- include('partials/_pagination') %>
      </div>
    </div>
  </section>